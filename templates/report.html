<!doctype html>
{# templates/report.html #}
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Shodan2DB</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
</head>
<body class="has-navbar-fixed-top">
<div class="container is-fluid">
    <div class="has-text-centered is-size-1">
        Surface exposure report
    </div>
    <br>
    <nav class="navbar is-fixed-top is-transparent mx-4">
        <div class="navbar-brand">
            <a class="navbar-item has-text-weight-semibold" href="#top">
                Shodan2DB
            </a>
        </div>
        <div class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item" href="#hosts-list">Hosts</a>
                <a class="navbar-item" href="#vulns-list">Vulnerabilities</a>
                <a class="navbar-item" href="#cve-list">CVE</a>
            </div>
        </div>
        <div class="navbar-end">
            <div class="navbar-item">
                <p class="control">
                    <input autofocus
                           class="input is-info is-rounded" type="text" placeholder="Filter"
                           id="searchbox"
                           oninput="liveSearch()"
                           placeholder="Filter"
                           type="search"/>
                </p>
            </div>
    </nav>
    <nav class="level">
        <div class="level-item has-text-centered">
            <div>
                <p class="heading">Hosts</p>
                <p class="title">{{ hosts |length }}</p>
            </div>
        </div>
        <div class="level-item has-text-centered">
            <div>
                <p class="heading">Vulnerabilities</p>
                <p class="title">{{ vulns |length }}</p>
            </div>
        </div>
        <div class="level-item has-text-centered">
            <div>
                <p class="heading">Products</p>
                <p class="title">{{ services |length }}</p>
            </div>
        </div>
        <div class="level-item has-text-centered">
            <div>
                <p class="heading">CVE</p>
                <p class="title">{{ cves |length }}</p>
            </div>
        </div>
    </nav>

    <p id="hosts-list" class="title is-3 is-spaced">Hosts</p>
    <table class="table is-hoverable is-bordered is-striped">
        <thead>
        <tr>
            <th>IP</th>
            <th>Hostnames</th>
            <th>ISP</th>
            <th>City</th>
            <th>Tags</th>
            <th>Vulns</th>
        </tr>
        </thead>
        <tbody>
        {% for host in hosts %}
        <tr>
            <td><a href="#{{ host.ip }}">{{ host.ip }}</a></td>
            <td>{{ host.hostnames }}</td>
            <td>{{ host.isp }}</td>
            <td>{{ host.city }}</td>
            <td>{{ host.tags }}</td>
            <td>{{ host.nbvulns }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <br>

    <p id="vulns-list" class="title is-3 is-spaced">Vulnerabilities</p>
    {% for host in hosts %}
    <section class="section">
        <div id="{{ host.ip }}" class="tile is-parent">
            <article class="tile is-child notification is-info">
                <p><a href="https://www.shodan.io/host/{{ host.ip }}" class="title">{{ host.ip }}</a> <span
                        class="tag is-rounded is-large">{{ host.nbvulns }}</span></p>
                <p class="subtitle">{{ host.hostnames }}</p>
                <div class="content">
                    <p>
                        <b>ISP</b> : {{ host.isp }}
                        <br><b>City</b> : {{ host.city }}
                        {% if host.tags %}
                        <br><b>Tags</b> : {{ host.tags }}
                        {% endif %}
                    </p>
                </div>
            </article>
        </div>
        <table class="table is-hoverable is-bordered is-striped">
            <thead>
            <tr>
                <th>Product</th>
                <th>Version</th>
                <th>Port</th>
                <th>Transport</th>
            </tr>
            </thead>
            <tbody>
            {% for service in services %}
            {% if service.ip == host.ip %}
            <tr>
                <td>{{ service.product }}</td>
                <td>{{ service.version }}</td>
                <td><a href="https://www.shodan.io/host/{{ host.ip }}#{{ service.port }}">{{ service.port }}</a>
                </td>
                <td>{{ service.transport }}</td>
            </tr>
            {% endif %}
            {% endfor %}
            </tbody>
        </table>
        <table class="table is-hoverable is-bordered">
            <thead>
            <tr>
                <th>CVE</th>
                <th>CVSS</th>
                <th>Description</th>
            </tr>
            </thead>
            <tbody>
            {% for vuln in vulns %}
            {% if vuln.ip == host.ip %}
            <tr>
                <td><a href="https://nvd.nist.gov/vuln/detail/{{ vuln.cveid }}">{{ vuln.cveid }}</a></td>
                <td>{{ vuln.cvss }}</td>
                <td>{{ vuln.summary }}</td>
            </tr>
            {% endif %}
            {% endfor %}
            </tbody>
        </table>
    </section>
    {% endfor %}


    <p id="cve-list" class="title is-3 is-spaced">Security vulnerability (CVE)</p>
    <table class="table is-hoverable is-bordered">
        <thead>
        <tr>
            <th>CVE</th>
            <th>Count</th>
            <th>CVSS</th>
            <th>Description</th>
        </tr>
        </thead>
        <tbody>
        {% for cve in cves %}
        <tr>
            <td><a href="https://nvd.nist.gov/vuln/detail/{{ cve.cveid }}">{{ cve.cveid }}</a></td>
            <td>{{ cve.count }}</td>
            <td>{{ cve.cvss }}</td>
            <td>{{ cve.summary }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

</body>
<script>
    function liveSearch() {
 let cards = document.querySelectorAll('.section')
    let search_query = document.getElementById("searchbox").value;
    for (var i = 0; i < cards.length; i++) {
      if(cards[i].innerText.toLowerCase()
        .includes(search_query.toLowerCase())) {
          cards[i].classList.remove("is-hidden");
    } else {
        cards[i].classList.add("is-hidden");
    }
  }
}
let typingTimer;
let typeInterval = 500; // Half a second
let searchInput = document.getElementById('searchbox');
searchInput.addEventListener('keyup', () => {
  clearTimeout(typingTimer);
  typingTimer = setTimeout(liveSearch, typeInterval);
});
</script>
</html>
